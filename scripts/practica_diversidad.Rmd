---
title: "Ánalisis de diversidad de especies en sitios simulados"
author: "Jimena Banda, Michelle Muñoz y Xymena Vazquez"
date: "10 de marzo del 2025"
output: html_document
---

## Indices alfa
Se creó una función que englobara todas los indices de diversidad alfa (Shannon, Pielou, Simpson, Simpson inverso, Gini y Chao 1), estos indices fueron puestos en forma de lista y a dicha funcion solo se le agregó el numero de invidividuos por cada especie.

```{r}
#Indice de Shannon
shannon<- function (abundancias){
  prob<- abundancias/sum(abundancias)
  return(-sum(prob*log(prob)))
}
#Indice de Pielou
pielou<- function(abundancias){
  shannon(abundancias)/log(length(abundancias))
}
#Indice de Simpson
simpson<- function(abundancias){
  prob<- abundancias/sum(abundancias)
  sum (prob*prob)
}
#Indice de Simpson inverso
simpson2<- function(abundancias){
  prob<- abundancias/sum(abundancias)
  1/ sum (prob*prob)
}
#Indice de Gini
gini<- function(abundancias){
  prob<- abundancias/sum(abundancias)
  simp<- sum(prob*prob)
  return(1-simp)
}
#Indice de Chao1
chao1<- function(x){
  s_obs<-length(x[x>0]) 
  f1<-length(x[which(x==1)]) 
  f2<-length(x[which(x==2)])
  return(s_obs+f1^2/(2*f2) )
}


alfa<- function(abundancias){
  lista_indices<-list(
    shannon= shannon(abundancias),
    pielou= pielou(abundancias),
    simpson= simpson(abundancias),
    simpson2= simpson2(abundancias),
    gini= gini(abundancias),
    chao1= chao1(abundancias)
  )
  return(lista_indices)
}

alfa(c(9, 7, 5, 5, 5, 4, 4, 3, 3, 3, 2))
alfa(c(18, 15, 10, 5, 4, 4, 3, 3, 2, 2, 1, 1))
alfa(c(67))
alfa(c(9, 8, 7, 6, 6, 2,1, 1))
alfa(c(88))
alfa(c(13, 12, 12, 12, 11, 7, 4, 3, 1))
alfa(c(14, 10, 3, 3, 2, 2, 2, 1, 1))

```

## Rank-abundance

A partir de 7 bolsas con fichas de distintos colores se obtuvieron datos de diversidad y abundancia para la comparación de estas mismas

Los datos de abundancia se capturaron en una base de datos

```{r}
abundance <- read.csv (file = "datos/abundancias.csv")
abundance

```

Las gráficas de abundancia se realizaron con el paquete "ggplot2"
```{r}
library (ggplot2)

#bolsa 1
rank1 <- ggplot(abundance, aes (x=especie, y=bolsa_1))+
  geom_bar (stat = "identity", fill = (c("purple", "pink", "lightblue", "hotpink2",
                                         "yellow", "lightgreen", "red", "orange",
                                         "blue", "darkblue", "darkgreen", "hotpink")))+
  xlab ("ABUNDANCIAS") + ylab ("ESPECIES")
  
rank1
```

El mismo código anterior se aplicó para cada una de las bolsas

```{r echo=FALSE}
rank2
rank3
rank4
rank5
rank6
rank7
```

## Curvas de rarefacción

Con las mismas bolsas de fichas se tomaron muestras para realizar las curvas de rarefacción, la suma acumulada entre cada muestreo se capturo en una base de datos y posteriormente se realizaron las curvas

```{r}
sumas <- read.csv(file = "datos/sumas.csv")
sumas

```

```{r warning=FALSE}
library(ggplot2)

#bolsa 1
b1 <- ggplot(sumas, aes( x=muestra, y=bolsa_1))+
  geom_point(color="red") + geom_line(color="red")+
  xlab ("MUESTRAS") + ylab ("ESPECIES NUEVAS")
b1
```

Se empleó el mismo código para el resto de las bolsas

```{r warning=FALSE}
b2
b3
b4
b5
b6
b7
```



## Índices de diversidad Alfa

## Índices de diversidad Beta


Se empleó el paquete Vegan para realizar la matriz de distancias con los métodos Jaccard y Bray-Curtis

```{r}
presencia <- read.csv(file = "datos/presencia.csv")

rownames(presencia)<- presencia$especie
presencia <- presencia [,-1]
presencia

```

La base de datos es de tipo binomial de acuerdo a la presencia y ausencia de cada uno de los colores de las fichas como especies, además se modificó para que la columna de especies de caracteres discretos sean los nombres de cada uno de los renglones y de esta forma obtener la matriz de forma correcta

```{r warning=FALSE}
library(vegan)

jac_matrix <- vegdist (presencia, method="jaccard")
jac_matrix
```

Para realizar la matriz de distancias con el método de Bray-Courtis es necesario contar con las abundancias de cada una de las bolsas, por lo que la base de datos empelada es de las abundancias de cada una de las especies, de igual forma se modificaron los nombres de los renglones

```{r}

abundancia <- read.csv(file = "datos/abundancias.csv")

rownames(abundancia)<- abundancia$especie
abundancia <- abundancia [,-1]
abundancia
```

```{r warning=FALSE}
bray_matrix <- vegdist (abundancia, method="bray")
bray_matrix
```

## Preguntas

1. ¿Cómo varían los valores de los índices entre los sitios? ¿Qué diferencias resaltan?
2. ¿Cuál índice es más sensible a especies raras?
3. ¿Por qué el índice de Pielou nos da información sobre la equitatividad de la comunidad?
4. ¿Cuál sitio parece tener mayor diversidad según la curva de rarefacción? ¿Por qué?

5. ¿Cómo afecta el tamaño de la muestra en la forma de la curva? A medida que disminuye el tamaño de las muestras, la cantidad de especies encontradas debería aumentar hasta llegar a un punto donde a pesar de que se sigan tomando muestras el número de las especies siga siendo el mismo y la curva en ese punto deje de crecer exponencialmente. 

6. ¿Cuál de estos índices es más sensible a la diferencia en abundancias? Los índices más sensibles a la deferencia de abundancias son los índices alfa pues estos índices trabajan sobre la riqueza y la equidad, esta última es directamente afectada sobre la abundancia porque a partir de ella se determinará si una especie domina o no sobre el sitio de estudio.  
7. ¿Qué interpretación ecológica tienen las diferencias entre sitios? Principalmente la diversidad de especies, esto podría proporcionar información ecológica de importancia como podría ser el efecto de la temperatura y condiciones ambientales, el acceso a alimento o incluso como se están interaccionando las especies (si hay la competencia, depredación, etc).  

8. ¿Cómo interpretas la forma de las curvas de abundancia? Todas las curvas se distribuyen de una manera muy diferente entre si principalmente porque la cantidad de individuo por especie no está normalizada, hay mucha variedad, sin embargo, en dos muestras solo se obtuvo un color de fichas, las curvas de estas fichas son las que más ajustadas se visualizan pues no hay variación entre los individuos de la población. 

9. ¿Qué implicaciones tienen para la dominancia de especies?
10. ¿Qué patrones generales observaste en la diversidad entre los sitios?
11. ¿Cuál índice te pareció más útil y por qué?
12. ¿Cómo podrías aplicar este análisis en estudios ecológicos reales?


## Contribuciones del equipo

Xymena Vazquez: ,indices alfa, discusión de preguntas
Michelle Muñoz: bases de datos, gráficas de abundancia, curvas de rarefacción, matrices de distancias, discusión de preguntas
Jimena Banda: indices beta, discusión de preguntas, discusión



